#!/usr/bin/env php
<?php
// TODO: allow for an arg describing where to output the array to. Could be the
// first arg or the last one (like cp)
function get_date($filename) {
	require($filename);
	if (isset($data['published'])) {
		return $data['published'];
	}
	$fh = fopen($filename, 'r');
	$date = null;
	while ($line = fgets($fh)) {
		if (strpos($line, 'published') !== false) {
			list( , $date, ) = explode("'", $line);
		}
	}
	fclose($fh);
	return $date;
}

if ($argc == 1) {
	echo "Nothing to process dates for!\n";
	exit(1);
}

$map = array();
foreach (array_slice($argv, 1) as $file) {
	$date = get_date($file);
	if ($date == null) {
		echo "No date found in {$file}\n";
		exit(2);
	}
	$map[strtotime($date)] = basename(dirname($file));
}

ob_start();
echo "<?php\n";
echo '$map = ';
var_export($map);
echo ";\n";
